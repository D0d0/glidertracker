@()

<!DOCTYPE html>
<html>
    <head>
        <title>Simple Map</title>
        <meta name="viewport" content="initial-scale=1.0">
        <meta charset="utf-8">
        <script src="@routes.Assets.versioned("javascripts/hello.js")" type="text/javascript"></script>
        <style>
                /* Always set the map height explicitly to define the size of the div
                 * element that contains the map. */
                #map {
                    height: 100%;
                }

                /* Optional: Makes the sample page fill the window. */
                html, body {
                    height: 100%;
                    margin: 0;
                    padding: 0;
                }
        </style>
    </head>
    <body>
        <div id="map"></div>
        <script>
                var map, markers = {};

                function initMap() {
                    map = new google.maps.Map(document.getElementById('map'), {
                        center: {lat: -34.397, lng: 150.644},
                        zoom: 8
                    });
                    var socket = new WebSocket("ws://localhost:9001/map/data");
                    socket.onmessage = function (event) {
                        var obj = JSON.parse(event.data),
                                marker
                        if (markers[obj.id]) {
                            marker = markers[obj.id]
                            marker.setPosition(new google.maps.LatLng(obj.lat, obj.lng));
                        } else {
                            marker = new google.maps.Marker({
                                position: obj,
                                map: map,
                                title: obj.id,
                                icon: {
                                    url: "@routes.Assets.versioned("images/glider.svg")",
                                    scaledSize: new google.maps.Size(25, 25),
                                    origin: new google.maps.Point(0, 0),
                                    anchor: new google.maps.Point(0, 0)
                                }
                            });

                            markers[obj.id] = marker
                        }
                    }
                }
        </script>
        <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA5GJWp5NL4avc9xQeIyOgc2GtrX8fRSCQ&callback=initMap">
        </script>
    </body>
</html>